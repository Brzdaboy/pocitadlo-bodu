<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Poƒç√≠tadlo bod≈Ø - V√≠ce her</title>

  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Poƒç√≠tadlo bod≈Ø">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-md mx-auto space-y-4">

    <h1 class="text-2xl font-bold text-center">Poƒç√≠tadlo bod≈Ø</h1>

    <!-- Spr√°va her jako horizont√°ln√≠ scroll tabs -->
    <div class="bg-white rounded-2xl shadow p-2 overflow-x-auto flex gap-2">
      <div id="gameTabs" class="flex gap-2"></div>
      <button onclick="newGame()" class="px-3 py-1 rounded-xl font-semibold border border-gray-400 text-gray-600">+ P≈ôidat hru</button>
    </div>

    <!-- P≈ôidat hr√°ƒçe -->
    <div class="bg-white rounded-2xl shadow p-4">
      <button onclick="addPlayer()" class="w-full bg-blue-600 text-white py-2 rounded-xl font-semibold">P≈ôidat hr√°ƒçe</button>
    </div>

    <!-- Aktu√°ln√≠ kolo -->
    <div class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-2">Aktu√°ln√≠ kolo</h2>
      <div id="players" class="space-y-3"></div>
      <button onclick="confirmRound()" class="mt-3 w-full bg-purple-600 text-white py-2 rounded-xl font-semibold">Potvrdit kolo</button>
    </div>

    <!-- Po≈ôad√≠ -->
    <div class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-2">Aktu√°ln√≠ po≈ôad√≠</h2>
      <ol id="leaderboard" class="text-sm"></ol>
    </div>

    <!-- Historie -->
    <div class="bg-white rounded-2xl shadow p-4">
      <h2 class="font-semibold mb-2">Historie kol</h2>
      <div id="history" class="text-sm space-y-1"></div>
      <button onclick="resetGame()" class="mt-3 text-red-600 font-semibold">Reset hry</button>
    </div>

  </div>

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js')
      .then(() => console.log('Service Worker registrov√°n'))
      .catch(err => console.log('Chyba registrace SW:', err));
  }

  let currentGame = null;
  let games = JSON.parse(localStorage.getItem('games') || '{}');

  function saveGames() { localStorage.setItem('games', JSON.stringify(games)); }

  function newGame() {
    const gameName = prompt('N√°zev nov√© hry:');
    if (!gameName) return;
    games[gameName] = { players: [], rounds: [] };
    saveGames();
    populateGameTabs();
    switchGame(gameName);
  }

  function populateGameTabs() {
    const tabsDiv = document.getElementById('gameTabs');
    tabsDiv.innerHTML = '';
    Object.keys(games).forEach(name => {
      const tabContainer = document.createElement('div');
      tabContainer.className = 'flex items-center gap-1';

      const tab = document.createElement('button');
      tab.textContent = name;
      tab.className = `px-3 py-1 rounded-xl font-semibold ${currentGame === name ? 'bg-purple-200 text-black' : 'bg-gray-200 text-gray-700'}`;
      tab.onclick = () => switchGame(name);

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'üóëÔ∏è';
      deleteBtn.className = 'px-1 py-1 text-sm';
      deleteBtn.onclick = (e) => {
        e.stopPropagation();
        if (confirm(`Opravdu smazat hru "${name}"?`)) {
          delete games[name];
          if (currentGame === name) currentGame = Object.keys(games)[0] || null;
          saveGames();
          populateGameTabs();
          if(currentGame) switchGame(currentGame);
          else document.getElementById('players').innerHTML='';
        }
      };

      tabContainer.appendChild(tab);
      tabContainer.appendChild(deleteBtn);
      tabsDiv.appendChild(tabContainer);
    });
  }

  function switchGame(name) { currentGame = name; if (!games[currentGame]) return; populateGameTabs(); renderPlayers(); renderHistory(); renderLeaderboard(); }
  function getPlayers() { return games[currentGame].players; }
  function getRounds() { return games[currentGame].rounds; }
  function saveCurrentGame() { saveGames(); }

  function addPlayer() { const players = getPlayers(); const newPlayer = `Hr√°ƒç ${players.length + 1}`; players.push({ name: newPlayer }); saveCurrentGame(); renderPlayers(); }
  function renderPlayers() { const players = getPlayers(); const playersDiv = document.getElementById('players'); playersDiv.innerHTML=''; players.forEach((p,i)=>{ const div=document.createElement('div'); div.className='flex gap-2 items-center'; div.innerHTML=`<input class="flex-1 font-semibold border-b" value="${p.name}" onchange="renamePlayer(${i}, this.value)" /><input type="number" class="score w-20 border rounded-xl p-2" placeholder="" min="0" inputmode="numeric" pattern="[0-9]*" /><button onclick="removePlayer(${i})" class="px-2 py-1 bg-red-500 text-white rounded-xl">X</button>`; playersDiv.appendChild(div);});}
  function renamePlayer(i,name){getPlayers()[i].name=name; saveCurrentGame(); renderLeaderboard();}
  function removePlayer(i){if(!confirm(`Opravdu smazat hr√°ƒçe ${getPlayers()[i].name}?`)) return; getPlayers().splice(i,1); saveCurrentGame(); renderPlayers(); renderLeaderboard();}

  function confirmRound(){const scores=document.querySelectorAll('.score');const round=[];scores.forEach((input,i)=>{const points=parseInt(input.value||0); round.push({name:getPlayers()[i].name,points}); input.value='';}); getRounds().push(round); saveCurrentGame(); renderHistory(); renderLeaderboard();}
  function renderHistory(){const h=document.getElementById('history'); h.innerHTML=''; getRounds().forEach((r,roundIndex)=>{const details=document.createElement('details'); details.className='border rounded-xl p-2'; const summary=document.createElement('summary'); summary.className='flex justify-between items-center cursor-pointer'; summary.innerHTML=`Kolo ${roundIndex+1} <span class="text-blue-500">‚úèÔ∏è Upravit</span>`; details.appendChild(summary); const contentDiv=document.createElement('div'); contentDiv.className='mt-2 space-y-1'; r.forEach((p,i)=>{ const row=document.createElement('div'); row.className='flex gap-2 items-center'; row.innerHTML=`<span class="flex-1">${p.name}:</span><input type='number' value='${p.points}' min='0' class='border rounded-xl p-1 w-20' onchange='updateHistory(${roundIndex},${i},this.value)' inputmode="numeric" pattern="[0-9]*" />`; contentDiv.appendChild(row);}); details.appendChild(contentDiv); h.appendChild(details);});}
  function updateHistory(roundIndex,playerIndex,value){getRounds()[roundIndex][playerIndex].points=parseInt(value)||0; saveCurrentGame(); renderLeaderboard();}
  function renderLeaderboard(){const totals={}; getRounds().flat().forEach(r=>totals[r.name]=(totals[r.name]||0)+r.points); const list=document.getElementById('leaderboard'); list.innerHTML=''; Object.entries(totals).sort((a,b)=>b[1]-a[1]).forEach(([name,pts],i)=>{ const li=document.createElement('li'); li.className='flex justify-between px-3 py-2 rounded-xl mb-1'; if(i===0) li.classList.add('bg-yellow-300','font-bold'); if(i===1) li.classList.add('bg-gray-300'); if(i===2) li.classList.add('bg-amber-600','text-white'); li.innerHTML=`<span>${i+1}. ${name}</span><span>${pts} b</span>`; list.appendChild(li);});}
  function resetGame(){
  if(!confirm('Opravdu resetovat sk√≥re hry?')) return;

  // sma≈æe se jen sk√≥re (kola), hr√°ƒçi z≈Østanou
  games[currentGame].rounds = [];

  saveCurrentGame();
  renderHistory();
  renderLeaderboard();
}


  if(Object.keys(games).length>0) switchGame(Object.keys(games)[0]);
  else populateGameTabs();
</script>
</body>
</html>
